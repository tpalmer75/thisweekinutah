angular.module("utahApp",["ui.router","firebase"]).config(function(e,t,n){t.otherwise("/"),n.html5Mode(!0),e.state("home",{url:"/",templateUrl:"templates/main.html",controller:"mainCtrl"}).state("event-detail",{url:"/events/:eventId",templateUrl:"templates/event-detail.html",controller:"eventCtrl"})}).controller("mainCtrl",function(e,t,n,r){e.startFirstWeek=moment().startOf("isoWeek"),e.endFirstWeek=moment().endOf("isoWeek"),e.startNextWeek=moment().add(7,"days").startOf("isoWeek"),e.endNextWeek=moment().add(7,"days").endOf("isoWeek"),e.startThirdWeek=moment().add(14,"days").startOf("isoWeek"),e.endThirdWeek=moment().add(14,"days").endOf("isoWeek");var a=t.data(),o=t.storage();e.dataReady=!1,e.serveURL=function(n){t.getImageURL(n.image).then(function(t){return console.log(t),n.imageURL=t,e.$apply(),t}).catch(function(e){console.log(e)})},a.$loaded().then(function(){e.dataReady=!0,console.log(a),angular.forEach(a,function(t){t.image="20170102-temple-lights.jpg",t.url=e.serveURL(t),console.log("url",t.url)}),e.eventData=a}).catch(function(e){console.log(e)})}).controller("eventCtrl",function(e){e.test="Hello event ctrl!"}).filter("filterWeek",function(){return function(e,t,n){if(void 0!==e){for(var r=[],a=0;a<e.length;a++){var o=e[a],l=moment(o.date),i=l.isBefore(t),s=l.isAfter(n);i||s||r.push(o)}return r}}}).factory("firebaseFactory",function(e){var t=new Date;t.setDate(t.getDate()-7);var n=t.toISOString(),r=new Date;r.setDate(r.getDate()+21);var a=r.toISOString(),o=firebase.database().ref(),l=e(o.child("events").orderByChild("date").startAt(n).endAt(a)),i=firebase.storage().ref(),s=function(e){return i.child("event-photos").child(e).getDownloadURL()};return{data:function(){return l},storage:function(){return i},getImageURL:function(e){return s(e)}}});
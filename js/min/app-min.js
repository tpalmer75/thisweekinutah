angular.module("utahApp",["ui.router","firebase"]).config(function(e,t,n){t.otherwise("/"),e.state("home",{url:"/",templateUrl:"templates/main.html",controller:"mainCtrl"}).state("event-detail",{url:"/events/:eventId",templateUrl:"templates/event-detail.html",controller:"eventCtrl"}).state("upload",{url:"/upload",templateUrl:"templates/upload.html",controller:"uploadCtrl"})}).run(function(e){e.$on("$stateChangeSuccess",function(){window.scrollTo(0,0)})}).controller("uploadCtrl",function(e,t,n){e.title="",e.description="",e.startDate="",e.endDate="",e.days="",e.image="",e.price="",e.time="",e.originalLink="",e.filteredDate=n("date")(e.startDate,"yyyy-mm-dd");var o="testKey",a={title:"",description:"",startDate:"",endDate:"",days:"",image:"",price:"",time:"",originalLink:""};e.pushData=function(){t.pushData(o,a)},e.imageFile={},e.email,e.password,e.isLoggedIn=!1,e.login=function(){firebase.auth().signInWithEmailAndPassword(e.email,e.password).then(function(){console.log("success"),e.isLoggedIn=!0,e.$apply()}).catch(function(e){console.log(e.code,e.message)})}}).directive("fileread",[function(){return{scope:{fileread:"="},link:function(e,t,n){t.bind("change",function(t){e.$apply(function(){e.imageFile=t.target.files[0],console.log(t.target.files[0])})})}}}]).controller("mainCtrl",function(e,t,n,o){o.title="This Week in Utah—Things to do this week",e.startFirstWeek=moment().startOf("isoWeek"),e.endFirstWeek=moment().endOf("isoWeek"),e.startNextWeek=moment().add(7,"days").startOf("isoWeek"),e.endNextWeek=moment().add(7,"days").endOf("isoWeek"),e.startThirdWeek=moment().add(14,"days").startOf("isoWeek"),e.endThirdWeek=moment().add(14,"days").endOf("isoWeek");var a=t.data();e.dataReady=!1,a.$loaded().then(function(){e.dataReady=!0,console.log(a),e.eventData=a}).catch(function(e){console.log(e)})}).controller("eventCtrl",function(e,t,n,o){e.eventInfo={};var a=t.singleEvent(n.eventId);e.event={},e.dataReady=!1,o.title="This Week in Utah",a.$loaded().then(function(){e.dataReady=!0,console.log(a),e.event=a,o.title=e.event.title+"—This Week in Utah"}).catch(function(e){console.log(e)})}).filter("filterWeek",function(){return function(e,t,n){if(void 0!==e){for(var o=[],a=0;a<e.length;a++){var i=e[a],l=moment(i.startDate),r=moment(i.endDate),s=l.isBefore(n),d=r.isAfter(t);s&&d&&o.push(i)}return o}}}).factory("firebaseFactory",function(e,t){var n=new Date;n.setDate(n.getDate()-7);var o=n.toISOString(),a=firebase.database().ref(),i=e(a.child("events").orderByChild("endDate").startAt(o)),l=firebase.storage().ref(),r=function(e,t){a.child("events/"+e).set(t),console.log("Data Uploaded to Firebase")},s=function(e){l.child("event-photos/"+e.name).put(e).then(function(){console.log("Tried to upload"),l.child("event-photos/"+e.name).getDownloadURL().then(function(e){return console.log(e),e}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},d=function(e){return t(a.child("events/"+e))};return{data:function(){return i},pushData:function(e,t){return r(e,t)},uploadFile:function(e){return s(e)},singleEvent:function(e){return d(e)}}});